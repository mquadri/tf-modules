#PaaS SQL setup
module "paas-sql-server-db" {
  source                                       = "../../sql-managed-instance"
  for_each                                     = var.application_sql_server
  location                                     = each.value.location
  resource_group_name                          = each.value.resource_group_name
  server_version                               = each.value.server_version
  administrator_login                          = each.value.administrator_login
  azuread_administrator                        = each.value.azuread_administrator
  connection_policy                            = each.value.connection_policy
  databases                                    = each.value.databases
  diagnostic_settings                          = each.value.diagnostic_settings
  elastic_pools                                = each.value.elastic_pools
  enable_telemetry                             = each.value.enable_telemetry
  firewall_rules                               = each.value.firewall_rules
  lock                                         = each.value.lock
  managed_identities                           = each.value.managed_identities
  name                                         = each.value.name
  outbound_network_restriction_enabled         = each.value.outbound_network_restriction_enabled
  primary_user_assigned_identity_id            = each.value.primary_user_assigned_identity_id
  private_endpoints                            = each.value.private_endpoints
  public_network_access_enabled                = each.value.public_network_access_enabled
  role_assignments                             = each.value.role_assignments
  tags                                         = each.value.tags
  transparent_data_encryption_key_vault_key_id = each.value.transparent_data_encryption_key_vault_key_id
  msftmigration                                = each.value.msftmigration
  environment                                  = each.value.environment
  app_id                                       = each.value.app_id
  key_vault_name                               = each.value.key_vault_name
  key_vault_rg_name                            = each.value.key_vault_rg_name
}

#SQL MI setup
module "application-sql-mi" {
  source                                  = "../../sql-managed-instance"
  for_each                                = var.application_sql_mi
  location                                = each.value.location
  resource_group_name                     = each.value.resource_group_name
  diagnostic_settings                     = each.value.diagnostic_settings
  enable_telemetry                        = each.value.enable_telemetry
  lock                                    = each.value.lock
  managed_identities                      = each.value.managed_identities
  private_endpoints                       = each.value.private_endpoints
  private_endpoints_manage_dns_zone_group = each.value.private_endpoints_manage_dns_zone_group
  role_assignments                        = each.value.role_assignments
  tags                                    = each.value.tags
  databases                               = each.value.databases
  failover_group                          = each.value.failover_group
  administrator_login                     = each.value.administrator_login
  enable_advanced_threat_protection       = each.value.enable_advanced_threat_protection
  license_type                            = each.value.license_type
  sku_name                                = each.value.sku_name
  storage_size_in_gb                      = each.value.storage_size_in_gb
  subnet_id                               = each.value.subnet_id
  vcores                                  = each.value.vcores
  collation                               = each.value.collation
  dns_zone_partner_id                     = each.value.dns_zone_partner_id
  maintenance_configuration_name          = each.value.maintenance_configuration_name
  minimum_tls_version                     = each.value.minimum_tls_version
  proxy_override                          = each.value.proxy_override
  public_data_endpoint_enabled            = each.value.public_data_endpoint_enabled
  storage_account_type                    = each.value.storage_account_type
  timeouts                                = each.value.timeouts
  timezone_id                             = each.value.timezone_id
  transparent_data_encryption             = each.value.transparent_data_encryption
  active_directory_administrator          = each.value.active_directory_administrator
  security_alert_policy                   = each.value.security_alert_policy
  storage_account_resource_id             = each.value.storage_account_resource_id
  vulnerability_assessment                = each.value.vulnerability_assessment
  zone_redundant_enabled                  = each.value.zone_redundant_enabled
  appid                                   = each.value.appid
  appname                                 = each.value.appname
  env                                     = each.value.env
  environment                             = each.value.environment
  additionalcontext                       = each.value.additionalcontext
  resourcetype                            = each.value.resourcetype
  msftmigration                           = each.value.msftmigration
  key_vault_name                          = each.value.key_vault_name
  key_vault_rg_name                       = each.value.key_vault_rg_name
}

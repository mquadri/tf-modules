## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | ~> 1.8 |
| <a name="requirement_azapi"></a> [azapi](#requirement\_azapi) | >= 1.13, < 2.0 |
| <a name="requirement_azuread"></a> [azuread](#requirement\_azuread) | 2.48.0 |
| <a name="requirement_azurerm"></a> [azurerm](#requirement\_azurerm) | >=3.11.0, < 5.0 |
| <a name="requirement_modtm"></a> [modtm](#requirement\_modtm) | ~> 0.3 |
| <a name="requirement_random"></a> [random](#requirement\_random) | ~> 3.5 |
| <a name="requirement_validation"></a> [validation](#requirement\_validation) | ~> 1.1.1 |

## Providers

No providers.

## Modules

| Name | Source | Version |
|------|--------|---------|
| <a name="module_vm-pattern"></a> [vm-pattern](#module\_vm-pattern) | ../../vm | n/a |

## Resources

No resources.

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_location"></a> [location](#input\_location) | The Azure region where resources will be deployed | `string` | n/a | yes |
| <a name="input_machine_creds_akv_rg"></a> [machine\_creds\_akv\_rg](#input\_machine\_creds\_akv\_rg) | keyvault name resource group name | `string` | n/a | yes |
| <a name="input_vm_admin_pwd_keyvault_name"></a> [vm\_admin\_pwd\_keyvault\_name](#input\_vm\_admin\_pwd\_keyvault\_name) | keyvault name to store admin password | `string` | n/a | yes |
| <a name="input_vm_config"></a> [vm\_config](#input\_vm\_config) | define the configuration for vm | <pre>map(object({<br>    vm_name                            = string<br>    resource_group_name                = string<br>    vm_size                            = string<br>    admin_username                     = string<br>    additionalcontext                  = string<br>    akv_resource_id                    = optional(string)<br>    availability_zone                  = optional(string, null)<br>    computer_name                      = optional(string, null)<br>    os_kernel_type                     = string<br>    generate_admin_password_or_ssh_key = bool<br>    managed_identities = optional(object({<br>      system_assigned            = optional(bool, false)<br>      user_assigned_resource_ids = optional(set(string), [])<br>    }))<br>    eviction_policy = optional(string, null)<br>    tags = object({<br>      app_id              = string<br>      appname             = string<br>      appid               = string<br>      env                 = string<br>      costCenter          = string<br>      costVP              = string<br>      costAppOwnerTech    = string<br>      costAppOwnerManager = string<br>      costBudgetOwner     = string<br>      costDivision        = string<br>      costAllocation      = string<br>      appFunction         = string<br>      monthlyBudget       = string<br>      costbaseline        = string<br>      managed_by          = string<br>      environment         = string<br>      msftmigration       = string<br>      os_support          = string<br>    })<br>    data_disk_config = optional(object({<br>      data_disk_enabled          = optional(bool)<br>      disk_controller_type       = optional(string, null)<br>      encryption_at_host_enabled = optional(bool, null)<br>      data_disks = optional(map(object({<br>        data_disk_name         = string<br>        data_disk_type         = string<br>        data_disk_size_gb      = number<br>        data_disk_caching      = string<br>        data_disk_machine_lun  = number<br>        trusted_launch_enabled = optional(bool, false)<br>      })))<br>    }))<br>    os_disk_config = object({<br>      os_disk_name              = string<br>      os_disk_cache             = string<br>      os_disk_size_gb           = number<br>      os_disk_type              = string<br>      os_disk_write_accelerator = bool<br>    })<br>    plan = optional(object({<br>      name      = string<br>      product   = string<br>      publisher = string<br>    }))<br>    source_image_config = object({<br>      publisher = string<br>      offer     = string<br>      sku       = string<br>      version   = string<br>    })<br>    network_interfaces = map(object({<br>      name = string<br>      ip_configurations = map(object({<br>        name = string<br>        app_gateway_backend_pools = optional(map(object({<br>          app_gateway_backend_pool_resource_id = string<br>        })), {})<br>        create_public_ip_address                                    = optional(bool, false)<br>        gateway_load_balancer_frontend_ip_configuration_resource_id = optional(string)<br>        is_primary_ipconfiguration                                  = optional(bool, true)<br>        load_balancer_backend_pools = optional(map(object({<br>          load_balancer_backend_pool_resource_id = string<br>        })), {})<br>        load_balancer_nat_rules = optional(map(object({<br>          load_balancer_nat_rule_resource_id = string<br>        })), {})<br>        private_ip_address            = optional(string)<br>        private_ip_address_allocation = optional(string, "Dynamic")<br>        private_ip_address_version    = optional(string, "IPv4")<br>        private_ip_subnet_resource_id = optional(string)<br>        public_ip_address_lock_name   = optional(string)<br>        public_ip_address_name        = optional(string)<br>        public_ip_address_resource_id = optional(string)<br>      }))<br>      accelerated_networking_enabled = optional(bool, false)<br>      application_security_groups = optional(map(object({<br>        application_security_group_resource_id = string<br>      })), {})<br>      diagnostic_settings = optional(map(object({<br>        name                                     = optional(string, null)<br>        log_categories                           = optional(set(string), [])<br>        log_groups                               = optional(set(string), [])<br>        metric_categories                        = optional(set(string), ["AllMetrics"])<br>        log_analytics_destination_type           = optional(string, null)<br>        workspace_resource_id                    = optional(string, null)<br>        storage_account_resource_id              = optional(string, null)<br>        event_hub_authorization_rule_resource_id = optional(string, null)<br>        event_hub_name                           = optional(string, null)<br>        marketplace_partner_resource_id          = optional(string, null)<br>      })), {})<br>      dns_servers             = optional(list(string))<br>      inherit_tags            = optional(bool, true)<br>      internal_dns_name_label = optional(string)<br>      ip_forwarding_enabled   = optional(bool, false)<br>      lock_level              = optional(string)<br>      lock_name               = optional(string)<br>      network_security_groups = optional(map(object({<br>        network_security_group_resource_id = string<br>      })), {})<br>      resource_group_name = optional(string)<br>      role_assignments = optional(map(object({<br>        principal_id                           = string<br>        role_definition_id_or_name             = string<br>        assign_to_child_public_ip_addresses    = optional(bool, true)<br>        condition                              = optional(string, null)<br>        condition_version                      = optional(string, null)<br>        delegated_managed_identity_resource_id = optional(string, null)<br>        description                            = optional(string, null)<br>        skip_service_principal_aad_check       = optional(bool, false)<br>        principal_type                         = optional(string, null)<br>      })), {})<br>      tags = optional(map(string), null)<br>    }))<br>    default_private_nic_enabled = optional(bool, false)<br>    public_ip_enabled           = optional(bool, false)<br>    public_ip_sku               = optional(string)<br>    public_vnet_name            = optional(string, "")<br>    public_vnet_rg              = optional(string, "")<br>    public_subnet               = optional(string, "")<br>    public_nsg                  = optional(string, "")<br>    public_nsg_rg               = optional(string, "")<br>    sr_sec_exception            = optional(string, "")<br>    public_only                 = optional(bool, false)<br>    nsg_diagnostic_settings = optional(map(object({<br>      name                                     = optional(string, null)<br>      log_categories                           = optional(set(string), [])<br>      log_groups                               = optional(set(string), ["allLogs"])<br>      metric_categories                        = optional(set(string), ["AllMetrics"])<br>      log_analytics_destination_type           = optional(string, "Dedicated")<br>      workspace_resource_id                    = optional(string, null)<br>      storage_account_resource_id              = optional(string, null)<br>      event_hub_authorization_rule_resource_id = optional(string, null)<br>      event_hub_name                           = optional(string, null)<br>      marketplace_partner_resource_id          = optional(string, null)<br>    })), {})<br>    machine_ssh_port = optional(number, 22)<br>    additional_security_rules = optional(map(object({<br>      access                                     = string<br>      name                                       = string<br>      description                                = optional(string)<br>      destination_address_prefix                 = optional(string)<br>      destination_address_prefixes               = optional(set(string))<br>      destination_application_security_group_ids = optional(set(string))<br>      destination_port_range                     = optional(string)<br>      destination_port_ranges                    = optional(set(string))<br>      direction                                  = string<br>      priority                                   = number<br>      protocol                                   = string<br>      source_address_prefix                      = optional(string)<br>      source_address_prefixes                    = optional(set(string))<br>      source_application_security_group_ids      = optional(set(string))<br>      source_port_range                          = optional(string)<br>      source_port_ranges                         = optional(set(string))<br>      timeouts = optional(object({<br>        create = optional(string)<br>        delete = optional(string)<br>        read   = optional(string)<br>        update = optional(string)<br>      }))<br>    })), {})<br>    nsg_creation_enabled     = optional(bool, false)<br>    vnet_name                = string<br>    subnet_name              = string<br>    accelerated_networking   = optional(bool, false)<br>    vnet_resource_group_name = string<br>    storage_analytics_name   = optional(string, null)<br>    storage_account_rg_name  = optional(string, null)<br><br>    auto_shutdown_config = optional(object({<br>      auto_shutdown_enabled                  = optional(bool, false)<br>      auto_shutdown_time                     = optional(string)<br>      auto_shutdown_timezone                 = optional(string)<br>      auto_shutdown_notification_enabled     = optional(bool, false)<br>      auto_shutdown_notification_time        = optional(string, null)<br>      auto_shutdown_notification_webhook_url = optional(string, null)<br>    }), {})<br>    additional_unattend_contents = optional(list(object({<br>      content = string<br>      setting = string<br>    })), [])<br>    bypass_platform_safety_checks_on_user_schedule_enabled = optional(bool, false)<br>    capacity_reservation_group_id                          = optional(string, null)<br>    proximity_placement_group                              = optional(string, null)<br>    dedicated_host_group_resource_id                       = optional(string, null)<br>    dedicated_host_resource_id                             = optional(string, null)<br>    edge_zone                                              = optional(string, null)<br>    diagnostic_settings = optional(map(object({<br>      name                                     = optional(string, null)<br>      log_categories                           = optional(set(string), [])<br>      log_groups                               = optional(set(string), [])<br>      metric_categories                        = optional(set(string), ["AllMetrics"])<br>      log_analytics_destination_type           = optional(string, "Dedicated")<br>      workspace_resource_id                    = optional(string, null)<br>      storage_account_resource_id              = optional(string, null)<br>      event_hub_authorization_rule_resource_id = optional(string, null)<br>      event_hub_name                           = optional(string, null)<br>      marketplace_partner_resource_id          = optional(string, null)<br>    })), {})<br>    extensions = optional(map(object({<br>      kernel_type                 = string<br>      name                        = string<br>      publisher                   = string<br>      type                        = string<br>      type_handler_version        = string<br>      auto_upgrade_minor_version  = optional(bool)<br>      automatic_upgrade_enabled   = optional(bool)<br>      failure_suppression_enabled = optional(bool, false)<br>      settings                    = optional(string)<br>      protected_settings          = optional(string)<br>      provision_after_extensions  = optional(list(string), [])<br>      tags                        = optional(map(string), null)<br>      protected_settings_from_key_vault = optional(object({<br>        secret_url      = string<br>        source_vault_id = string<br>      }))<br>    })), {})<br>    lock = optional(object({<br>      name = optional(string, null)<br>      kind = string<br>    }), null)<br>    max_bid_price       = optional(number, -1)<br>    priority            = optional(string, "Regular")<br>    vtpm_enabled        = optional(bool, false)<br>    secure_boot_enabled = optional(bool, null)<br>    azure_backup_configurations = optional(map(object({<br>      resource_group_name       = optional(string, null)<br>      recovery_vault_name       = string<br>      backup_policy_resource_id = optional(string, null)<br>      exclude_disk_luns         = optional(list(number), null)<br>      include_disk_luns         = optional(list(number), null)<br>      protection_state          = optional(string, null)<br>    })), {})<br>    license_type                 = optional(string, null)<br>    availability_set_resource_id = optional(string, null)<br>    source_image_resource_id     = optional(string, null)<br><br>    new_backup_config = optional(object({<br>      create_recovery_vault          = optional(bool, false)<br>      recovery_create_resource_group = optional(bool, null)<br>      recovery_resource_group_name   = optional(string, null)<br>      recovery_rg_role_assignments = optional(map(object({<br>        role_definition_id_or_name             = string<br>        principal_id                           = string<br>        description                            = optional(string, null)<br>        skip_service_principal_aad_check       = optional(bool, false)<br>        condition                              = optional(string, null)<br>        condition_version                      = optional(string, null)<br>        delegated_managed_identity_resource_id = optional(string, null)<br>        principal_type                         = optional(string, null)<br>      })), {})<br>      recovery_lock = optional(object({<br>        kind = string<br>        name = optional(string, null)<br>      }), null)<br>      recovery_location                           = optional(string, null)<br>      recovery_services_vault_name                = optional(string, null)<br>      recovery_vault_sku                          = optional(string, "Standard")<br>      recovery_vault_storage_mode_type            = optional(string, "LocallyRedundant")<br>      recovery_vault_cross_region_restore_enabled = optional(bool, false)<br>      recovery_vault_soft_delete_enabled          = optional(bool, true)<br>      recovery_vault_immutability                 = optional(string, "Disabled")<br>      recovery_enable_encryption                  = optional(bool, false)<br>      recovery_vault_identity_type                = optional(string, null)<br>      recovery_enable_private_endpoint            = optional(bool, false)<br>      recovery_subscription_id                    = optional(string, null)<br>      recovery_pe_subnet_name                     = optional(string, null)<br>      recovery_virtual_network_name               = optional(string, null)<br>      recovery_virtual_network_rg                 = optional(string, null)<br>      recovery_vm_backup_policies = optional(map(object({<br>        name                           = string<br>        policy_type                    = string<br>        timezone                       = string<br>        instant_restore_retention_days = optional(number)<br>        frequency                      = string<br>        time                           = string<br>        hour_interval                  = optional(number)<br>        hour_duration                  = optional(number)<br>        weekdays                       = optional(set(string))<br>        daily = optional(list(object({<br>          count = number<br>        })), [])<br>        weekly = optional(list(object({<br>          count    = number<br>          weekdays = optional(set(string))<br>        })), [])<br>        monthly = optional(list(object({<br>          count             = number<br>          weekdays          = optional(set(string))<br>          weeks             = optional(set(string))<br>          days              = optional(set(number))<br>          include_last_days = optional(bool)<br>        })), [])<br>        yearly = optional(list(object({<br>          count             = number<br>          weekdays          = optional(set(string))<br>          weeks             = optional(set(string))<br>          months            = optional(set(string))<br>          days              = optional(set(number))<br>          include_last_days = optional(bool)<br>        })), [])<br>      })), {})<br>      file_share_backup_policies = optional(map(object({<br>        name      = string<br>        timezone  = string<br>        frequency = string<br>        time      = string<br>        daily = optional(list(object({<br>          count = number<br>        })), [])<br>        weekly = optional(list(object({<br>          count    = number<br>          weekdays = set(string)<br>        })), [])<br>        monthly = optional(list(object({<br>          count             = number<br>          weekdays          = optional(set(string))<br>          weeks             = optional(set(string))<br>          days              = optional(set(number))<br>          include_last_days = optional(bool)<br>        })), [])<br>        yearly = optional(list(object({<br>          count             = number<br>          weekdays          = optional(set(string))<br>          weeks             = optional(set(string))<br>          months            = optional(set(string))<br>          days              = optional(set(number))<br>          include_last_days = optional(bool)<br>        })), [])<br>      })), {})<br>      recovery_key_vault_key_name          = optional(string, null)<br>      recovery_key_vault_name              = optional(string, null)<br>      recovery_key_vault_rg_name           = optional(string, null)<br>      infrastructure_encryption_enabled    = optional(bool, false)<br>      recovery_kv_role_definition          = optional(string, "Key Vault Crypto Service Encryption User")<br>      user_assigned_identity_rg_name       = optional(string, null)<br>      existing_user_assigned_identity_name = optional(string, null)<br>      recovery_vault_public_access_enabled = optional(bool, false)<br>      recovery_private_endpoints = optional(map(object({<br>        name                           = string<br>        private_connection_resource_id = string<br>        is_manual_connection           = optional(bool)<br>        subresource_names              = list(string)<br>        request_message                = optional(string)<br>        private_dns_zone_group_name    = optional(string)<br>        private_dns_zone_ids           = optional(list(string))<br>      })), {})<br>      recovery_domain_name = optional(string, null)<br>      recovery_a_records = optional(map(object({<br>        name                = string<br>        resource_group_name = string<br>        zone_name           = string<br>        ttl                 = number<br>        records             = list(string)<br>        tags                = optional(map(string), null)<br>      })), {})<br>      recovery_aaa_records = optional(map(object({<br>        name                = string<br>        resource_group_name = string<br>        zone_name           = string<br>        ttl                 = number<br>        records             = list(string)<br>        tags                = optional(map(string), null)<br>      })), {})<br>      recovery_cname_records = optional(map(object({<br>        name                = string<br>        resource_group_name = string<br>        zone_name           = string<br>        ttl                 = number<br>        record              = string<br>        tags                = optional(map(string), null)<br>      })), {})<br>      recovery_mx_records = optional(map(object({<br>        name                = optional(string, "@")<br>        resource_group_name = string<br>        zone_name           = string<br>        ttl                 = number<br>        records = map(object({<br>          preference = number<br>          exchange   = string<br>        }))<br>        tags = optional(map(string), null)<br>      })), {})<br>      recovery_enable_telemetry = optional(bool, true)<br>      recovery_ptr_records = optional(map(object({<br>        name                = string<br>        resource_group_name = string<br>        zone_name           = string<br>        ttl                 = number<br>        records             = list(string)<br>        tags                = optional(map(string), null)<br>      })), {})<br>      recovery_soa_record = optional(object({<br>        email        = string<br>        expire_time  = optional(number, 2419200)<br>        minimum_ttl  = optional(number, 10)<br>        refresh_time = optional(number, 3600)<br>        retry_time   = optional(number, 300)<br>        ttl          = optional(number, 3600)<br>        tags         = optional(map(string), null)<br>      }), null)<br>      recovery_srv_records = optional(map(object({<br>        name                = string<br>        resource_group_name = string<br>        zone_name           = string<br>        ttl                 = number<br>        records = map(object({<br>          priority = number<br>          weight   = number<br>          port     = number<br>          target   = string<br>        }))<br>        tags = optional(map(string), null)<br>      })), {})<br>      recovery_txt_records = optional(map(object({<br>        name                = string<br>        resource_group_name = string<br>        zone_name           = string<br>        ttl                 = number<br>        records = map(object({<br>          value = string<br>        }))<br>        tags = optional(map(string), null)<br>      })), {})<br>      recovery_tags = optional(map(string), null)<br>      recovery_virtual_network_links = optional(map(object({<br>        vnetlinkname     = string<br>        vnetid           = string<br>        autoregistration = optional(bool, false)<br>        tags             = optional(map(string), null)<br>      })), {})<br>      recovery_dns_zone_id                    = optional(string, "")<br>      recovery_create_dns_zone                = optional(bool, false)<br>      recovery_enable_diagnostic_setting      = optional(bool, false)<br>      recovery_diagnostics_settings_name      = optional(string, null)<br>      recovery_log_categories                 = optional(list(string), [])<br>      recovery_excluded_log_categories        = optional(list(string), [])<br>      recovery_metric_categories              = optional(list(string), [])<br>      recovery_logs_destinations_ids          = optional(list(string), [""])<br>      recovery_log_analytics_destination_type = optional(string, "AzureDiagnostics")<br>    }), {})<br>  }))</pre> | n/a | yes |

## Outputs

No outputs.
